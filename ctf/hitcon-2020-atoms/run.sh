#!/bin/bash

gcc ./exploit.c -o exploit -static -lpthread
cp exploit ./initramfs
cd ./initramfs
find . | cpio -o -H newc | gzip > ../initramfs.cpio.gz
cd ../

qemu-system-x86_64 \
  -kernel ./bzImage \
  -initrd ./initramfs.cpio.gz \
  -nographic \
  -monitor none \
  -cpu qemu64 \
  -append "console=ttyS0 kaslr panic=-1 softlockup_panic=1" \
  -no-reboot \
  -m 256M -smp cores=2
