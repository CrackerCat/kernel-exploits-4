#!/bin/sh

gcc exploit.c -o initramfs/exploit -static -lpthread

cd ./initramfs
find . | cpio -H newc -o | gzip > ../initramfs1.cpio.gz
cd ../

qemu-system-x86_64 -cpu kvm64,+smep,+smap \
  -m 128M \
  -kernel ./bzImage \
  -initrd ./initramfs1.cpio.gz \
  -nographic \
  -monitor /dev/null \
  -no-reboot \
  -append "root=/dev/ram rw rdinit=/root/init console=ttyS0 loglevel=3 oops=panic nokaslr panic=1" \
  -s
